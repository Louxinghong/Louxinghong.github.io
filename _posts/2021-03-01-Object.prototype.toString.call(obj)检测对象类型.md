---
layout: post
title: Object.prototype.toString.call(obj)检测对象类型
subtitle: 简单记录
date: 2021-03-01
author: louxinghong
header-img: img/2021-03-01/2021-03-01.jpg
catalog: true
tags:
  - JavaScript
---

# 前言

众所周知，typeof 无法精准地判断一个对象变量的类型，比如 null 和数组的类型都为 object，这时候我们就要选择更精准的方法来进行判断。

# 较好的方式

使用 Object.prototype.toString.call(obj)方法能精准地翻盘一个对象变量的类型。

```Js
console.log(Object.prototype.toString.call("jerry")); // [object String]
console.log(Object.prototype.toString.call(12)); // [object Number]
console.log(Object.prototype.toString.call(true)); // [object Boolean]
console.log(Object.prototype.toString.call(undefined)); // [object Undefined]
console.log(Object.prototype.toString.call(null)); // [object Null]
console.log(Object.prototype.toString.call({name: "jerry"})); // [object Object]
console.log(Object.prototype.toString.call(function(){})); // [object Function]
console.log(Object.prototype.toString.call([])); // [object Array]
console.log(Object.prototype.toString.call(new Date)); // [object Date]
console.log(Object.prototype.toString.call(/\d/)); // [object RegExp]
function Person(){};
console.log(Object.prototype.toString.call(new Person)); // [object Object]
```

关于 toString()方法，其返回对应对象的字符串。那么为何不能直接使用 obj.toString()呢？

```Js
console.log("jerry".toString()); // jerry
console.log((1).toString()); // 1
console.log([1,2].toString()); // 1,2
console.log(new Date().toString()); // Wed Dec 21 2016 20:35:48 GMT+0800 (中国标准时间)
console.log(function(){}.toString()); // function (){}
console.log(null.toString()); // error
console.log(undefined.toString()); // error
```

同样是 obj 调用 toString()方法，但是 obj.toString()的结果和 Object.prototype.toString.call(obj)的结果是不一样的。

## 原因

toString()是 Object 的原型方法，调用该方法，默认返回当前对象的[[Class]]。这是一个内部属性，其格式为 [object Xxx] ，其中 Xxx 就是对象的类型。

对于 Object 对象，直接调用 toString()就能返回[object Object]。而对于其他对象，则需要通过 call / apply 来调用才能返回正确的类型信息。

而 Array 或 function 等类型作为 Object 的实例都重写了 toString()方法，不同对象调用 toString()方法时，根据原型链的原则，调用到的是重写之后的 toString()方法(Array 类型返回元素组成的字符串，Function 类型返回内容为函数体的字符串...)，而不会去调用 Object 上原型 toString 方法(返回对象的具体类型)，所以上述两者的结果是不一样的。

若我们将 Array 的 toString()方法删掉，根据原型链的原则，它调用的就是 Object 的 toString()方法。

```Js
let testArray = [1,2,3];
console.log(Array.prototype.hasOwnProperty("toString")); // true
console.log(testArray.toString()); // 1,2,3
delete Array.prototype.toString; // delete操作符可以删除实例属性
console.log(Array.prototype.hasOwnProperty("toString")); // false
console.log(testArray.toString()); // "[object Array]"
```

# 总结

判断类型的方法有 typeof、instanceof、constructor 和 bject.prototype.toString.call()，前三种都有利有弊，在简单判断中可使用，但要精准判断还是推荐用最后一种。

也算是对老知识的整理记录。

0.0
